<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Engagement Guestbook</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Italianno&family=Tangerine:wght@700&display=swap" rel="stylesheet">
<style>
/* body {
  font-family: 'Dancing Script', cursive;
  text-align: center;
  padding: 20px;
  margin: 0;
  background: linear-gradient(135deg, #fffaf0, #ffe4c4);
  color: #333;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1, h2 {
  color: #c71585;
  margin: 10px 0;
  font-weight: 700;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
} */

body {
  font-family: 'Tangerine', cursive; /* default body font */
  text-align: center;
  padding: 20px;
  margin: 0;
  background: url(https://plus.unsplash.com/premium_photo-1693118932029-691d3a99fe45?q=80&w=880&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D) no-repeat center center fixed;
  background-size: cover;
  color: #333;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  font-family: 'Italianno', cursive;  /* heading font */
  color: #c71585;
  margin: 0;
  font-weight: 400;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  font-size: 3rem; /* adjust as needed */
}

h2 {
  font-family: 'Tangerine', cursive; /* subheading font */
  color: #000;
  margin: 5px 0 20px 0; 
  font-weight: 700;
  text-shadow: 1px 1px 1px rgba(0,0,0,0.05);
  font-size: 1.8rem; /* adjust as needed */
}

#videoContainer {
  width: 100%;
  max-width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  background: black;
}

video {
  width: 100%;
  height: auto;
  max-height: 90vh;
  border: 2px solid #c71585;
  border-radius: 8px;
  object-fit: contain;
}

/* button {
  margin: 5px;
  padding: 12px 25px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background-color: #ff69b4;
  color: white;
  transition: background-color 0.3s;
}
button:hover { background-color: #ff1493; } */

button {
  margin: 10px 5px;
  padding: 14px 35px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 50px;
  border: none;
  background: linear-gradient(135deg, #c71585, #ff1493); /* darker, more visible */
  color: white;
  font-weight: 700;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}
button:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.4);
}

input[type=file] { margin: 15px 0; }

/* Modal styling */
#uploadModal {
  display: none;
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background-color: rgba(0,0,0,0.5);
  z-index:1000;
}
#modalContentWrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}
#modalContent {
  background:white;
  padding:20px;
  border-radius:10px;
  width:80%;
  max-width:300px;
  text-align:center;
  font-size:18px;
  color:#c71585;
}
.spinner {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #c71585;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  margin: 15px auto;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#recordingBadge {
  display: none;
  color: white;
  background-color: red;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: bold;
  margin: 10px;
}
#actionButtons { display:none; margin-top:10px; }

</style>
</head>
<body>

<h1>With Love, From You</h1>
<h2>Record a message or share a photo to celebrate this special day with us</h2>

<div id="recordingBadge">‚óè Recording...</div>

<div id="videoContainer">
  <video id="preview" autoplay muted playsinline></video>
  <video id="playback" controls playsinline style="display:none;"></video>
</div>

<br>
<button id="startVideo">Start Video</button>
<button id="stopVideo" style="display:none;">Stop Video</button>
<br>
<input type="file" accept="image/*,video/*" id="mediaInput" multiple>
<br>
<div id="actionButtons">
  <button id="send">Send</button>
  <button id="discard">Discard</button>
</div>

<div id="uploadModal">
  <div id="modalContentWrapper">
    <div id="modalContent">
      <div class="spinner" id="spinner"></div>
      <div id="modalText">Uploading...</div>
    </div>
  </div>
</div>

<script>
let mediaRecorder;
let recordedChunks = [];
let currentMimeType = '';
const preview = document.getElementById('preview');
const playback = document.getElementById('playback');
const startBtn = document.getElementById('startVideo');
const stopBtn = document.getElementById('stopVideo');
const sendBtn = document.getElementById('send');
const discardBtn = document.getElementById('discard');
const actionButtons = document.getElementById('actionButtons');
const mediaInput = document.getElementById('mediaInput');
const modal = document.getElementById('uploadModal');
const modalText = document.getElementById('modalText');
const spinner = document.getElementById('spinner');
const recordingBadge = document.getElementById('recordingBadge');
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzzQQvIFTFHyBQOWFj6cXNywv2LsPFtHXwNEtxbA6x4cX0POZRa8J6lXVmN6N3Pvru_/exec';

mediaInput.addEventListener('change', () => {
  actionButtons.style.display = mediaInput.files.length > 0 ? 'block' : 'none';
});

function getSupportedMimeType() {
  if (typeof MediaRecorder === 'undefined') return '';
  if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) return 'video/webm;codecs=vp9';
  if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8')) return 'video/webm;codecs=vp8';
  if (MediaRecorder.isTypeSupported('video/mp4')) return 'video/mp4';
  return 'video/webm';
}

navigator.mediaDevices.getUserMedia({ video: true, audio: true })
.then(stream => {
  preview.srcObject = stream;
  currentMimeType = getSupportedMimeType();
  try { mediaRecorder = new MediaRecorder(stream, { mimeType: currentMimeType }); }
  catch(err) { mediaRecorder = new MediaRecorder(stream); currentMimeType = mediaRecorder.mimeType || currentMimeType || 'video/webm'; }

  mediaRecorder.ondataavailable = e => { if(e.data && e.data.size>0) recordedChunks.push(e.data); };

  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: currentMimeType || 'video/webm' });
    playback.src = URL.createObjectURL(blob);
    playback.style.display = 'block';
    preview.style.display = 'none';
    stopBtn.style.display = 'none';
    actionButtons.style.display = 'block';
    startBtn.style.display = 'none';
  };

  startBtn.onclick = () => {
    recordedChunks = [];
    mediaRecorder.start();
    recordingBadge.style.display = 'inline-block';
    actionButtons.style.display = 'none';
    playback.src = '';
    stopBtn.style.display = 'inline-block';
    startBtn.style.display = 'none';
  };

  stopBtn.onclick = () => {
    mediaRecorder.stop();
    recordingBadge.style.display = 'none';
  };
});

discardBtn.onclick = () => {
  recordedChunks = [];
  playback.src = '';
  playback.style.display = 'none';
  preview.style.display = 'block';
  actionButtons.style.display = 'none';
  mediaInput.value = '';
  startBtn.style.display = 'inline-block';
  stopBtn.style.display = 'none';
};

async function uploadFileAsBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = function(){
      const base64Data = reader.result.split(',')[1];
      fetch(APPS_SCRIPT_URL, {
        method:'POST',
        body:new URLSearchParams({ data: base64Data, mimeType:file.type, filename:file.name })
      }).then(res => res.text()).then(resolve).catch(reject);
    };
    reader.onerror = err => reject(err);
    reader.readAsDataURL(file);
  });
}

sendBtn.onclick = async () => {
  const filesToUpload = [];
  if(recordedChunks.length > 0){
    const blob = new Blob(recordedChunks, {type: currentMimeType || 'video/webm'});
    const ext = (currentMimeType && currentMimeType.includes('mp4')) ? 'mp4':'webm';
    filesToUpload.push(new File([blob],`video_${Date.now()}.${ext}`,{type:blob.type}));
  }
  if(mediaInput.files.length>0) filesToUpload.push(...Array.from(mediaInput.files));
  if(filesToUpload.length===0){ alert('Please record or select files first!'); return; }

  modal.style.display='block'; spinner.style.display='block';
  try{
    for(let i=0;i<filesToUpload.length;i++){
      modalText.textContent=`Uploading ${i+1} of ${filesToUpload.length}...`;
      await uploadFileAsBase64(filesToUpload[i]);
    }
    spinner.style.display='none'; modalText.textContent='All files uploaded successfully! üéâ';
    setTimeout(()=>{
      modal.style.display='none';
      recordedChunks=[]; mediaInput.value=''; playback.src=''; playback.style.display='none';
      preview.style.display='block'; actionButtons.style.display='none';
      startBtn.style.display='inline-block'; stopBtn.style.display='none';
    },2000);
  }catch(err){
    console.error(err);
    spinner.style.display='none';
    modalText.textContent='Upload failed! Please try again.';
    setTimeout(()=>{ modal.style.display='none'; },3000);
  }
};
</script>
</body>
</html>















