<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Engagement Guestbook</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  text-align: center;
  padding: 20px;
  background: linear-gradient(to bottom, #fff1f5, #ffe4e1);
  color: #333;
}
h1, h2 { color: #c71585; }
video {
  border: 2px solid #c71585;
  border-radius: 8px;
  margin: 10px 0;
  max-width: 90%;
}
button {
  margin: 5px;
  padding: 12px 25px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background-color: #ff69b4;
  color: white;
  transition: background-color 0.3s;
}
button:hover { background-color: #ff1493; }
input[type=file] { margin: 15px 0; }

/* Modal styling */
#uploadModal {
    display: none;
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background-color: rgba(0,0,0,0.5);
    z-index:1000;
}
#modalContentWrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
}
#modalContent {
    background:white;
    padding:20px;
    border-radius:10px;
    width:80%;
    max-width:300px;
    text-align:center;
    font-size:18px;
    color:#c71585;
}

/* Spinner */
.spinner {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #c71585;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  margin: 15px auto;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<h1>Welcome to Our Engagement!</h1>
<h2>Record a Video or Take a Photo for Us ðŸ’–</h2>

<video id="preview" autoplay muted playsinline></video>
<video id="playback" controls playsinline></video>
<br>
<button id="startVideo">Start Video</button>
<button id="stopVideo">Stop Video</button>
<br>
<input type="file" accept="image/*" id="photoInput">
<br>
<button id="send">Send</button>

<!-- Modal -->
<div id="uploadModal">
  <div id="modalContentWrapper">
    <div id="modalContent">
      <div class="spinner" id="spinner"></div>
      <div id="modalText">Uploading...</div>
    </div>
  </div>
</div>

<script>
let mediaRecorder;
let recordedChunks = [];
const preview = document.getElementById('preview');
const playback = document.getElementById('playback');
const startBtn = document.getElementById('startVideo');
const stopBtn = document.getElementById('stopVideo');
const sendBtn = document.getElementById('send');
const photoInput = document.getElementById('photoInput');
const modal = document.getElementById('uploadModal');
const modalText = document.getElementById('modalText');
const spinner = document.getElementById('spinner');

navigator.mediaDevices.getUserMedia({ video: true, audio: true })
.then(stream => {
  preview.srcObject = stream;
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = e => { if(e.data.size>0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = () => { 
    const blob = new Blob(recordedChunks, { type: 'video/mp4' });
    playback.src = URL.createObjectURL(blob);
  };

  startBtn.onclick = () => { recordedChunks = []; mediaRecorder.start(); alert("Recording started!"); };
  stopBtn.onclick = () => { mediaRecorder.stop(); alert("Recording stopped!"); };
})
.catch(err => alert("Camera access denied: " + err));

sendBtn.onclick = () => {
  let file;
  if(recordedChunks.length > 0) {
    file = new Blob(recordedChunks, { type: 'video/mp4' }); 
  } else if(photoInput.files.length > 0) {
    file = photoInput.files[0];
  } else { 
    alert("Please record a video or select a photo first!"); 
    return; 
  }

  // Show modal
  modal.style.display = 'block';
  modalText.textContent = 'Uploading...';
  spinner.style.display = 'block';

  const formData = new FormData();
  formData.append("file", file, file.name);

  fetch("https://script.google.com/macros/s/AKfycby6W5UvZbya4hfubxoHnQE4e17q8CslpjivVHcws_BsbmkEQ8dhizgKMVeI-SwIO3t0/exec", { // Replace with your Apps Script URL
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(text => {
    console.log(text);
    spinner.style.display = 'none';
    modalText.textContent = "Thank you for sharing your message! ðŸŽ‰";

    setTimeout(() => {
      modal.style.display = 'none';
      recordedChunks = [];
      photoInput.value = '';
      playback.src = '';
    }, 2000);
  })
  .catch(err => {
    console.error(err);
    spinner.style.display = 'none';
    modalText.textContent = "Upload failed! Please try again.";

    setTimeout(() => { modal.style.display = 'none'; }, 3000);
  });
};
</script>
</body>
</html>


